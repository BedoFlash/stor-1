<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø£Ø¯Ù…Ù†</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }

        body {
            background-color: #f4f4f4;
            text-align: center;
        }

        .dashboard-container {
            width: 90%;
            max-width: 1200px;
            margin: 30px auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: #333;
        }

        .stats-container {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .stat-box {
            width: 30%;
            min-width: 200px;
            padding: 20px;
            background: #007bff;
            color: white;
            border-radius: 8px;
            box-shadow: 0px 0px 5px rgba(0, 0, 0, 0.1);
            text-align: center;
            font-size: 20px;
        }

        .stat-box span {
            display: block;
            font-size: 30px;
            font-weight: bold;
            margin-top: 10px;
        }

        .actions-container {
            margin-top: 20px;
        }

        .admin-btn {
            display: block;
            width: 250px;
            margin: 10px auto;
            padding: 15px;
            background: #28a745;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            text-align: center;
            font-size: 18px;
            transition: 0.3s;
        }

        .admin-btn:hover {
            background: #218838;
        }

        .logout-btn {
            background: #dc3545;
        }

        .logout-btn:hover {
            background: #c82333;
        }
    </style>
</head>
<body>

    <div class="dashboard-container">
        <h1>ğŸ”¹ Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø£Ø¯Ù…Ù† ğŸ”¹</h1>

        <div class="stats-container">
            <div class="stat-box">
                ğŸ‘¥ Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡
                <span id="userCount">0</span>
            </div>
            <div class="stat-box">
                ğŸ“¦ Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø¨Ø§Øª
                <span id="orderCount">0</span>
            </div>
            <div class="stat-box">
                ğŸ”¥ Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ø£ÙƒØ«Ø± Ø·Ù„Ø¨Ù‹Ø§
                <span id="topProduct">-</span>
                <small id="topProductCount">0 Ø·Ù„Ø¨</small>
            </div>
        </div>

        <div class="actions-container">
            <a href="./view orders.html" class="admin-btn">ğŸ“¦ Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</a>
            <a href="./Show Data Admen.html" class="admin-btn">ğŸ“‹ Ø¹Ø±Ø¶ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</a>
            <a href="./Most requested requests.html" class="admin-btn">ğŸ”¥ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø£ÙƒØ«Ø± Ø·Ù„Ø¨Ù‹Ø§</a>
            <a href="index.html" class="admin-btn logout-btn">ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</a>
        </div>
    </div>

    <script>
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø¨Ø¯ÙˆÙ† Ø±ÙŠÙØ±ÙŠØ´
        function updateStats() {
            const storedUsers = JSON.parse(localStorage.getItem('users')) || [];
            const storedOrders = JSON.parse(localStorage.getItem('orders')) || [];

            document.getElementById('userCount').innerText = storedUsers.length;
            document.getElementById('orderCount').innerText = storedOrders.length;

            updateMostRequestedProduct();
        }

        // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ø£ÙƒØ«Ø± Ø·Ù„Ø¨Ù‹Ø§
        function updateMostRequestedProduct() {
            const storedOrders = JSON.parse(localStorage.getItem('orders')) || [];
            const productCount = {};

            // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ localStorage
            if (!Array.isArray(storedOrders) || storedOrders.length === 0) {
                document.getElementById('topProduct').innerText = "Ù„Ø§ ÙŠÙˆØ¬Ø¯";
                document.getElementById('topProductCount').innerText = "0 Ø·Ù„Ø¨";
                return;
            }

            // Ø­Ø³Ø§Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ù„ÙƒÙ„ Ù…Ù†ØªØ¬
            storedOrders.forEach(order => {
                if (order.products && Array.isArray(order.products)) {
                    order.products.forEach(product => {
                        if (product.name && product.quantity) {
                            productCount[product.name] = (productCount[product.name] || 0) + product.quantity;
                        }
                    });
                }
            });

            // Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ø£ÙƒØ«Ø± Ø·Ù„Ø¨Ù‹Ø§
            const sortedProducts = Object.entries(productCount).sort((a, b) => b[1] - a[1]);
            const topProduct = sortedProducts.length > 0 ? sortedProducts[0] : null;

            const topProductElement = document.getElementById('topProduct');
            const topProductCountElement = document.getElementById('topProductCount');

            if (topProduct) {
                topProductElement.innerText = topProduct[0];
                topProductCountElement.innerText = `${topProduct[1]} Ø·Ù„Ø¨`;
            } else {
                topProductElement.innerText = "Ù„Ø§ ÙŠÙˆØ¬Ø¯";
                topProductCountElement.innerText = "0 Ø·Ù„Ø¨";
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± `localStorage`
        window.addEventListener('storage', updateStats);

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        document.addEventListener('DOMContentLoaded', updateStats);

        // Ù…Ø­Ø§ÙƒØ§Ø© Ø¥Ø¯Ø®Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª (ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø²Ø§Ù„ØªÙ‡Ø§ Ø¨Ø¹Ø¯ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±)
        function simulateOrders() {
            const testOrders = [
                { id: 1, products: [{ name: "Ø¢ÙŠÙÙˆÙ† 14", quantity: 10 }, { name: "Ù„Ø§Ø¨ØªÙˆØ¨ Dell", quantity: 5 }] },
                { id: 2, products: [{ name: "Ø¢ÙŠÙÙˆÙ† 14", quantity: 7 }, { name: "Ø³Ù…Ø§Ø¹Ø§Øª AirPods", quantity: 4 }] }
            ];

            localStorage.setItem('orders', JSON.stringify(testOrders));
            window.dispatchEvent(new Event('storage')); // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§
        }

        // simulateOrders(); // Ù‚Ù… Ø¨ØªØ´ØºÙŠÙ„ Ù‡Ø°Ù‡ Ø§Ù„Ø¯Ø§Ù„Ø© Ù„Ø¥Ø¶Ø§ÙØ© Ø·Ù„Ø¨Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©
    </script>

</body>
</html>
